<app-header2></app-header2>
<app-spinner></app-spinner>

  <div *ngIf="!walletService.initialized_currency" class="blur-overlay">
  </div>


  <section class=" container-fluid ">

    <div class="deposit-container">

      <div class="content">

        <!-- ---------------- Crypto Deposit ---------------- -->
        <div *ngIf="walletService.selectedMode === 'TRON' ||  walletService.selectedMode === 'USD'" class="box">
          <!-- <h3>Crypto Deposit</h3> -->


          <!-- üîπ Crypto Deposit Section -->

          <div *ngIf="storeData.store['deposit']?.length" class="crypto-section card p-3">
              <div class="x-flex">
                <h5>Crypto Deposit</h5>
                <span class="text-main f-bold">{{storeData.store['deposit'][0].amount|currencyConverter:true:storeData.store['deposit'][0].method}}</span>
              </div>
              <div *ngIf="walletService.selectedMode === 'USD' || walletService.selectedMode === 'TRON'" class="alert alert-info d-flex  align-items-center gap-1 mt-5" role="alert">
                <i class="ti ti-alert-triangle fs-5 text-warning"></i>
                <span class="color" *ngIf="storeData.store['deposit'][0].method === 'USD'">
                  <strong class="text-deem">Deposit Instructions:</strong> Copy and send only <strong>USDT-TRC20</strong> payment to the address below.

                </span>
                <span class="color" *ngIf="storeData.store['deposit'][0].method === 'TRON'">
                  <strong>Deposit Instructions:</strong> Copy and send only <strong>TRON</strong> payment to the address below.

                </span>
              </div>

              <div class="wallet-address d-flex align-items-center justify-content-between">
                <code style="color:#06131d;">{{ storeData.store['deposit'][0].extraField.pay_address |truncateCenter:20 }}</code>
                <button (click)="walletService.copyContent(storeData.store['deposit'][0].extraField.pay_address)" class="copy-btn btn btn-sm btn-outline-primary w-50" >
                  <i class="ti ti-copy"></i> Copy
                </button>
              </div>

              <div class="text-center mt-3">
                <small  (click)="walletService.cancelPayment('deposit')" class="text-danger"> <i class="ti ti-trash fs-five"></i> Delete transaction</small>
              </div>

              <div class="qr-code text-center mt-3">
                <qrcode [qrdata]="storeData.store['deposit'][0].extraField.pay_address" [width]="150" [errorCorrectionLevel]="'M'"></qrcode>
              </div>


          </div>

          <div *ngIf="!storeData.store['deposit']?.length" class="card">
            <!-- form select -->
            <form  [formGroup]="walletService.formView['deposit']" (ngSubmit)="walletService.handleSubmit(walletService.formView['deposit'],'create_deposit')">
              <!-- Select Coin -->
              <div class="mb-3">
                <label>Select Chain</label>

                <div class="custom-select-wrapper" >
                    <div class="custom-select-trigger" (click)="walletService.toggleDropdown()">
                      <img *ngIf="walletService.SelectedCryptoImg" [src]="walletService.SelectedCryptoImg" alt="" class="crypto-img">
                      {{ walletService.SelectedCrypto || 'Select Currency' }}
                      <span class="arrow">&#9662;</span>
                    </div>

                    <div class="custom-options" [class.show]="walletService.dropdownOpen">
                      <div
                        class="custom-option"
                        *ngFor="let crypto of walletService.cryptos"
                        (click)="walletService.selectCrypto(crypto,walletService.formView['deposit'])"
                      >
                        <img *ngIf="crypto.img" [src]="crypto.img" alt="" class="crypto-img">
                        {{ crypto.label }}
                      </div>
                    </div>
                  </div>

              </div>

              <div class="mb-3">
                <!-- Amount Input -->
                <label>Amount</label>
                <input
                  type="number"
                  [(ngModel)]="amount"
                  placeholder="Min {{walletService.selectedCurrency?.symbol}}{{walletService.minimumPayment}}"
                  [min]="walletService.minimumPayment"
                  class=" mb-3 n11-bg"
                  formControlName="amount"
                >
              </div>


            <button
               [class.inactive-btn]="!walletService.formView['deposit'].valid"
              class="cmn-btn px-5 py-3 mb-6 w-100 mt-4">
              SUBMIT <i class="ti ti-arrow-right"></i>

            </button>

            </form>
          </div>

        </div>

        <!-- ---------------- Bank Deposit ---------------- -->
        <div *ngIf="walletService.selectedMode === 'BANK'" class="box">

          <div *ngIf="walletService.selectedMode === 'BANK' && storeData.store['deposit']?.length" class="bank-section card p">
            <div>
              <div class="x-flex">
                <h5>Bank Deposit</h5>
                <small (click)="walletService.cancelPayment('deposit')" class="text-danger text-small "> <i class="ti ti-trash fs-five"></i> Delete  transaction</small>
                <div class="" *ngIf="!walletService.previewUrl">
                  <span class="color text-s">{{storeData.store['deposit'][0].amount|currencyConverter:true:storeData.store['deposit'][0].method}}</span>
                </div>
              </div>
              <div  class="alert alert-info  d-flex align-items-center gap-2 mt-5" role="alert">
                <i class="ti ti-alert-triangle fs-5 text-warning"></i>
                <span *ngIf="storeData.store['local_banks']&&storeData.store['local_banks'][0].automatic" class="color">
                    Click the Payment Page link below to complete your payment!
                    <br>
                    <button (click)="goToPaymentPage(storeData.store['deposit'][0])" class="btn btn" type="button" name="button">
                      Payment Page <i class="ti ti-arrow-right"></i>
                    </button>
                </span>
                <span *ngIf="storeData.store['local_banks']&&!storeData.store['local_banks'][0].automatic&&!storeData.store['deposit'][0].proof&&storeData.store['deposit'][0].generator!=='awaiting_deposit_confirmation';else paymentProofText" class="color">
                    Deposit to our verified bank account and {{storeData.store['local_banks'][0].currency==='NGN'?'click on the payment completed button.':'upload the payment receipt.'}}
                    <!-- upload receipt completed to upload your proof. -->
                </span>
                <ng-template #paymentProofText >
                  <span
                    [class.text-success]="walletService.previewUrl"
                    class="color">
                      Your {{storeData.store['deposit'][0].amount|currencyConverter:true:storeData.store['deposit'][0].method}} deposit is currently awaiting confirmation.
                      <span class="color mt-4">Note: Bank network could be delayed: payment takes up to 0- 3 hours to reflect.</span>
                  </span>
                  </ng-template>

              </div>


                <div *ngIf="storeData.store['local_banks']&&!storeData.store['local_banks'][0].automatic">

                  <div *ngIf="storeData.store['local_banks'] as banks">

                    <div *ngIf="!storeData.store['deposit'][0].proof&&storeData.store['deposit'][0].generator!=='awaiting_deposit_confirmation';else awaitingpaymentConfirmationBlock">


                      <div class="widget has-shadow">
                          <div class="widget-body">

                            <ul class="nav nav-pills mb-3" role="tablist">
                              <li
                                class="nav-item"
                                role="presentation"
                                *ngFor="let bank of banks; let i = index"
                              >
                                <button
                                  class="nav-link"
                                  [class.active]="i === 0"
                                  id="pills-{{ bank.bank }}-tab"
                                  data-bs-toggle="pill"
                                  [attr.data-bs-target]="'#pills-' + bank.bank"
                                  type="button"
                                  role="tab"
                                  [attr.aria-selected]="i === 0"
                                >
                                  {{ bank.bank }}
                                </button>
                              </li>
                            </ul>

                            <!-- üîπ Tab Content -->
                            <div class="tab-content">
                              <div
                                class="tab-pane fade"
                                *ngFor="let bank of banks; let i = index"
                                [class.show]="i === 0"
                                [class.active]="i === 0"
                                id="pills-{{ bank.bank }}"
                                role="tabpanel"
                              >
                                <!-- Bank Content -->
                                <!-- <p><strong>Bank:</strong> {{ bank.bank }}</p>
                                <p><strong>Account:</strong> {{ bank.account_number }}</p> -->

                                <ul  class="item-flex-list">
                                  <li><span class="text-first">{{bank.currency==='AOA'?'IBAN':'Account Number:'}}</span>
                                    <span class="">
                                      <button (click)="walletService.copyContent(bank.account_number)" class="copy-btn btn btn-sm btn-outline-primary text" >
                                        <i class="ti ti-copy"></i> Copy
                                      </button><br>
                                      {{ bank.account_number }}
                                    </span>
                                  </li>
                                  <li><span class="text-first">Account Name</span> <span>{{ bank.account_holder }}</span></li>
                                  <li><span class="text-first">Bank Name:</span> <span>{{ bank.bank }}</span></li>

                                </ul>
                              </div>
                            </div>

                          </div>
                        </div>
                        <br>

                      <button *ngIf="storeData.store['local_banks'][0].currency==='NGN'" (click)="walletService.sendSendersName=true" style="font-size: 10px;" class="cmn-btn btn-sm text-center payment-completed" type="button" name="button">Payment completed</button>
                    </div>

                  </div>

                  <div class="text-cente mt-4">
                  </div>


                  <ng-template #awaitingpaymentConfirmationBlock>
                    <ul *ngIf="storeData.store['deposit'][0] as deposit" class="item-flex-list">
                      <li><span class="text-first">Amount:</span> <span>{{ deposit.amount|currencyConverter:true:storeData.store['deposit'][0].method }}</span></li>
                      <li><span class="text-first">Created at:</span><span>{{deposit.timestamp|timeFormat:"fullDate"}}</span></li>
                      <li><span class="text-first">Confirming:</span> <span class="text-deem"> {{deposit.timestamp|countdown:3|async}} </span></li>
                    </ul>
                  </ng-template>



                  <div *ngIf="storeData.store['local_banks'][0].currency!=='NGN';else attachSendersNameBlock" class="upload-wrapper mb-3 mt-5 text-center ">
                    <div class="">
                      <label for="fileInput">
                        <img [src]="walletService.previewUrl || defaultImage" class="upload-preview" alt="Upload image" />
                      </label>
                      <input
                        type="file"
                        id="fileInput"
                        hidden
                        accept="image/*"
                        (change)="walletService.onImageSelected($event)"
                      >
                      <small *ngIf="" class="error"></small>

                    </div>

                    <h6 *ngIf="!walletService.previewUrl" class="text-deem" style="display:flex;justify-content:center" >Upload Receipt</h6>

                  </div>


                </div>
                <ng-template #attachSendersNameBlock>

                  <!-- <h6 class="text-deem" style="display:flex;justify-content:center" *ngIf="!walletService.previewUrl;else attachSendersNameBlock">Upload Receipt</h6> -->

                    <div *ngIf="!storeData.store['deposit'][0].proof&&walletService.sendSendersName">
                      <input
                        [(ngModel)]="walletService.localDepositSendersName"
                        type="text"
                        placeholder="Senders Name"
                        class="n11-bg mb-3"
                      />
                      <span></span>

                      <!-- [class.inactive-btn]="!walletService.selectedFile||!walletService.localDepositSendersName" -->

                      <button
                        class="cmn-btn px-5 py-3 mb-6 w-100"
                        [class.inactive-btn]="!walletService.localDepositSendersName"
                        (click)="walletService.paymentCompleted()"
                        >
                        SEND <i class="ti ti-arrow-right"></i>
                      </button>
                    </div>
                </ng-template>
            </div>
          </div>

          <div *ngIf="!storeData.store['deposit']?.length" class="card">
            <!-- form -->
            <form  [formGroup]="walletService.formView['deposit']" (ngSubmit)="walletService.handleSubmit(walletService.formView['deposit'],'create_deposit')">
                <!-- Select Currency -->
              <!-- <div class="mb-5">
                <label>Select Currency</label>
                <select
                [ngModel] = "walletService.SelectedBank"
                (change)="walletService.onCurrencySelect($event)"
                formControlName='payment_method'
                  >
                  <option *ngFor="let c of walletService.initCurrencies.slice(2)" [value]="c.code">
                    {{ c.name }} ({{ c.symbol }})
                  </option>
                </select>
              </div> -->

              <div class="mb-3">
                <!-- <label>Select Chain</label> -->

                <div class="custom-select-wrapper" >
                    <div class="custom-select-trigger" (click)="walletService.toggleDropdown()">

                      {{ walletService.SelectedBank || 'Select Currency' }}
                      <span class="arrow">&#9662;</span>
                    </div>

                    <div class="custom-options" [class.show]="walletService.dropdownOpen">
                      <div
                        class="custom-option"
                        *ngFor="let c of walletService.initCurrencies.slice(2)"
                        (click)="walletService.selectLocal(c,walletService.formView['deposit'])"
                      >
                        <!-- <img *ngIf="crypto.img" [src]="crypto.img" alt="" class="crypto-img"> -->
                        {{ c.name }}
                      </div>
                    </div>
                  </div>

              </div>

                <div *ngIf="walletService.selectedCurrency" class="mb-3">
                  <!-- Amount Input -->
                  <label>Amount</label>
                  <input
                    type="number"
                    [(ngModel)]="amount"
                    placeholder="Min {{walletService.selectedCurrency?.symbol}}{{walletService.minimumPayment}}"
                    [min]="walletService.minimumPayment"
                    class=" mb-3 n11-bg"
                    formControlName="amount"
                  >
                </div>


              <button
                 [class.inactive-btn]="!walletService.formView['deposit'].valid"
                class="cmn-btn px-5 py-3 mb-6 w-100 mt-4">Submit <i class="ti ti-arrow-right"></i>
              </button>

            </form>
          </div>

        </div>
      </div>


    </div>


  </section>

  <div
    class="modal fade"
    id="selectPaymentMethod"
    tabindex="-1"
    aria-labelledby="selectPaymentMethod"
    aria-hidden="true"
    data-bs-backdrop="static"
    data-bs-keyboard="false"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content payment-modal">

        <div class="modal-body text-center">
          <h2>Select Payment Method</h2>
          <p class="text-muted">You must choose a payment option</p>

          <div class="options gap-4">
            <button  class="btn btn-primary w-100 crypto cmn-btn px-5 py-3 w-100 mb-4" (click)="select('crypto')">
              üí∞ Crypto Currency
              <br>
              <small class="btn-recom text-success">(Recommeded)</small>
            </button>

            <button class="btn btn-success w-100 crypto cmn-btn px-5 py-3 w-100 mb-4 linear" (click)="select('bank')">
              üè¶ Local Bank
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
